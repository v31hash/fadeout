
class TVShow {

  constructor(
    id,
    backdropPath = null,
    name,
    originalName = null,
    overview,
    firstAirDate,
    lastAirDate = null,
    posterPath,
    voteAverage,
    originalLanguage = null,
    genres = [],
    status = null,
    type = null,
    inProduction = null,
    nextEpisodeToAir = null,  // object or null
    numberOfSeasons = null,
    numberOfEpisodes = null,
    episodeRunTime = [],       // minutes; often an array
    networks = [],
    productionCompanies = [],
    originCountry = [],
    spokenLanguages = [],
    voteCount = 0,
    popularity = 0,
    tagline = null,
    homepage = null,
  ) {

    this.id = id;
    this.backdropPath = backdropPath;
    this.name = name; // TV show title
    this.originalName = originalName;
    this.overview = overview;
    this.firstAirDate = firstAirDate;
    this.lastAirDate = lastAirDate;
    this.posterPath = posterPath;
    this.voteAverage = voteAverage;

    this.originalLanguage = originalLanguage;
    this.genres = genres;
    this.status = status;
    this.type = type;
    this.inProduction = inProduction;
    this.nextEpisodeToAir = nextEpisodeToAir;

    this.numberOfSeasons = numberOfSeasons;
    this.numberOfEpisodes = numberOfEpisodes;
    this.episodeRunTime = episodeRunTime;

    this.networks = networks;
    this.productionCompanies = productionCompanies;
    this.originCountry = originCountry;
    this.spokenLanguages = spokenLanguages;

    this.voteCount = voteCount;
    this.popularity = popularity;
    this.tagline = tagline;
    this.homepage = homepage;
  }

  static fromJson(json) {
    return new TVShow(
      json.id,
      json.backdrop_path ?? null,
      json.name, // TMDb uses "name" for TV shows
      json.original_name ?? null,
      json.overview ?? null,
      json.first_air_date ?? null,
      json.last_air_date ?? null,
      json.poster_path ?? null,
      Number(json.vote_average) || 0,

      json.original_language ?? null,
      Array.isArray(json.genres) ? json.genres : [],
      json.status ?? null,
      json.type ?? null,
      typeof json.in_production === 'boolean' ? json.in_production : null,
      json.next_episode_to_air ?? null,

      Number(json.number_of_seasons) || null,
      Number(json.number_of_episodes) || null,
      Array.isArray(json.episode_run_time) ? json.episode_run_time : [],

      Array.isArray(json.networks) ? json.networks : [],
      Array.isArray(json.production_companies) ? json.production_companies : [],
      Array.isArray(json.origin_country) ? json.origin_country : [],
      Array.isArray(json.spoken_languages) ? json.spoken_languages : [],

      Number(json.vote_count) || 0,
      Number(json.popularity) || 0,
      json.tagline ?? null,
      json.homepage ?? null,
    );
  }

  getPosterUrl(size = 'w342') {
    if (!this.posterPath) {
      return 'assets/images/noImage.png'; // fallback image
    }
    return `https://image.tmdb.org/t/p/${size}${this.posterPath}`;
  }

  getScorePercentage() {
    return (this.voteAverage * 10).toFixed(0) + '%';
  }

  get firstAirYear() {
    if (!this.firstAirDate) return null;
    const d = new Date(this.firstAirDate);
    return Number.isNaN(d.getTime()) ? null : d.getUTCFullYear();
  }

  // Use the first runtime or average if you prefer
  get averageEpisodeRuntime() {
    if (!Array.isArray(this.episodeRunTime) || this.episodeRunTime.length === 0) return null;
    const sum = this.episodeRunTime.reduce((a, b) => a + b, 0);
    return Math.round(sum / this.episodeRunTime.length);
  }

} // class
